<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drive Links Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="manifest" href="#" id="manifestPlaceholder">
    <meta name="theme-color" content="#ffffff"/>
    <style>
        .offline-message {
            display: none;
        }
        .offline .offline-message {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app" class="p-6 max-w-6xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">Google Drive Links Manager</h1>
        
        <div class="offline-message bg-yellow-100 border-l-4 border-yellow-500 p-4 mb-4">
            Anda sedang offline. Beberapa fitur mungkin tidak tersedia.
        </div>

        <!-- Form Input -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-lg font-semibold mb-4">Tambah Link Baru</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" id="title" placeholder="Judul" class="border p-2 rounded">
                <input type="text" id="url" placeholder="URL Google Drive" class="border p-2 rounded">
                <input type="text" id="category" placeholder="Kategori" class="border p-2 rounded">
                <input type="text" id="source" placeholder="Sumber" class="border p-2 rounded">
                <input type="date" id="dateAdded" class="border p-2 rounded">
                <input type="text" id="tags" placeholder="Tag (pisahkan dengan koma)" class="border p-2 rounded">
                <textarea id="description" placeholder="Deskripsi" class="border p-2 rounded md:col-span-2"></textarea>
            </div>
            <button onclick="addLink()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Tambah Link
            </button>
        </div>

        <!-- Table -->
        <div class="overflow-x-auto">
            <table class="min-w-full bg-white rounded-lg shadow">

<thead class="bg-gray-100">
    <tr>
        <th class="p-3 text-left cursor-pointer" onclick="sortLinks('title')">Judul</th>
        <th class="p-3 text-left cursor-pointer" onclick="sortLinks('url')">Link</th>
        <th class="p-3 text-left cursor-pointer" onclick="sortLinks('category')">Kategori</th>
        <th class="p-3 text-left cursor-pointer" onclick="sortLinks('source')">Sumber</th>
        <th class="p-3 text-left cursor-pointer" onclick="sortLinks('dateAdded')">Tanggal</th>
        <th class="p-3 text-left cursor-pointer" onclick="sortLinks('tags')">Tag</th>
        <th class="p-3 text-left cursor-pointer" onclick="sortLinks('description')">Deskripsi</th>
        <th class="p-3 text-left">Aksi</th>
    </tr>
</thead>

                <tbody id="linksTableBody"></tbody>
            </table>
        </div>

        <!-- Export/Import Buttons -->
        <div class="mt-4 space-x-2">
            <button onclick="exportData()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                Export Data
            </button>
            <label class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 cursor-pointer">
                Import Data
                <input type="file" id="importFile" accept=".json" class="hidden" onchange="importData(event)">
            </label>
        </div>
    </div>

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(registration => console.log('ServiceWorker registered'))
                .catch(error => console.log('ServiceWorker registration failed:', error));
        }

        // Manifest Generation
        const manifest = {
            name: "Drive Links Manager",
            short_name: "DriveLinks",
            start_url: ".",
            display: "standalone",
            background_color: "#ffffff",
            theme_color: "#ffffff",
            icons: [
                {
                    src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='192' height='192'%3E%3Crect width='24' height='24' fill='%234285f4'/%3E%3Cpath d='M12 2L2 19h20L12 2z' fill='white'/%3E%3C/svg%3E",
                    sizes: "192x192",
                    type: "image/svg+xml"
                }
            ]
        };
        const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifestPlaceholder').href = manifestURL;

        // Data Management
        let links = JSON.parse(localStorage.getItem('driveLinks')) || [];

let editingLinkId = null; // Variabel untuk menyimpan ID link yang sedang diedit

function editLink(id) {
    const link = links.find(link => link.id === id);
    if (link) {
        editingLinkId = link.id; // Simpan ID link yang sedang diedit
        document.getElementById('title').value = link.title;
        document.getElementById('url').value = link.url;
        document.getElementById('category').value = link.category;
        document.getElementById('source').value = link.source;
        document.getElementById('dateAdded').value = link.dateAdded;
        document.getElementById('tags').value = link.tags;
        document.getElementById('description').value = link.description;
    }
}

function addLink() {
    const title = document.getElementById('title').value;
    const url = document.getElementById('url').value;
    const category = document.getElementById('category').value;
    const source = document.getElementById('source').value;
    const dateAdded = document.getElementById('dateAdded').value;
    const tags = document.getElementById('tags').value;
    const description = document.getElementById('description').value;

    if (editingLinkId) {
        // Jika sedang edit, perbarui data yang ada
        const linkIndex = links.findIndex(link => link.id === editingLinkId);
        if (linkIndex !== -1) {
            links[linkIndex] = {
                id: editingLinkId,
                title,
                url,
                category,
                source,
                dateAdded,
                tags,
                description
            };
        }
        editingLinkId = null; // Reset ID edit
    } else {
        // Jika tidak, tambahkan data baru
        const newLink = {
            id: Date.now(),
            title,
            url,
            category,
            source,
            dateAdded,
            tags,
            description
        };
        links.push(newLink);
    }

    saveAndRender();
    clearForm();
}

        function deleteLink(id) {
            links = links.filter(link => link.id !== id);
            saveAndRender();
        }

        function clearForm() {
            ['title', 'url', 'category', 'source', 'dateAdded', 'tags', 'description'].forEach(id => {
                document.getElementById(id).value = '';
            });
        }

        function saveAndRender() {
            localStorage.setItem('driveLinks', JSON.stringify(links));
            renderLinks();
        }

let sortDirection = {}; // Untuk menyimpan arah sorting (asc/desc) per kolom

function sortLinks(column) {
    // Tentukan arah sorting (default: ascending)
    if (!sortDirection[column]) {
        sortDirection[column] = 'asc';
    } else {
        sortDirection[column] = sortDirection[column] === 'asc' ? 'desc' : 'asc';
    }

    // Urutkan data
    links.sort((a, b) => {
        if (a[column] < b[column]) return sortDirection[column] === 'asc' ? -1 : 1;
        if (a[column] > b[column]) return sortDirection[column] === 'asc' ? 1 : -1;
        return 0;
    });

    // Perbarui tampilan tabel
    renderLinks();
}

        function renderLinks() {
            const tbody = document.getElementById('linksTableBody');
            tbody.innerHTML = links.map(link => `
                <tr class="border-t">
                    <td class="p-3">${link.title}</td>
                    <td class="p-3">
                        <a href="${link.url}" target="_blank" rel="noopener noreferrer" 
                           class="text-blue-500 hover:underline">Buka Link</a>
                    </td>
                    <td class="p-3">${link.category}</td>
                    <td class="p-3">${link.source}</td>
                    <td class="p-3">${link.dateAdded}</td>
                    <td class="p-3">${link.tags}</td>
                    <td class="p-3">${link.description}</td>
                    <td class="p-3">
    			<button onclick="editLink(${link.id})" 
            			class="bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 mr-2">
        		Edit
    			</button>
    			<button onclick="deleteLink(${link.id})" 
            			class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">
        		Hapus
    			</button>
		     </td>
                </tr>
            `).join('');
        }

        // Export/Import Functions
        function exportData() {
            const dataStr = JSON.stringify(links, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'drive-links-export.json';
            link.click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        links = importedData;
                        saveAndRender();
                        alert('Data berhasil diimpor!');
                    } catch (error) {
                        alert('Error mengimpor data: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        }

        // Offline detection
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        function updateOnlineStatus() {
            document.body.classList.toggle('offline', !navigator.onLine);
        }

        // Initial render
        renderLinks();
        updateOnlineStatus();
    </script>
</body>
</html>